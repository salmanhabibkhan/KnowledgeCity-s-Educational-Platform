"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.AwsLoadBalancerControllerAddOn = void 0;
const iam = require("aws-cdk-lib/aws-iam");
require("reflect-metadata");
const registry_utils_1 = require("../../utils/registry-utils");
const helm_addon_1 = require("../helm-addon");
const iam_policy_1 = require("./iam-policy");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const utils = require("../../utils");
const AWS_LOAD_BALANCER_CONTROLLER = 'aws-load-balancer-controller';
/**
 * Defaults options for the add-on
 */
const defaultProps = {
    name: AWS_LOAD_BALANCER_CONTROLLER,
    namespace: 'kube-system',
    chart: AWS_LOAD_BALANCER_CONTROLLER,
    repository: 'https://aws.github.io/eks-charts',
    release: AWS_LOAD_BALANCER_CONTROLLER,
    version: '1.12.0',
    enableShield: false,
    enableWaf: false,
    enableWafv2: false,
    createIngressClassResource: true,
    ingressClass: "alb",
    enableServiceMutatorWebhook: false
};
function lookupImage(registry, region) {
    if (registry == null) {
        console.log("Unable to get ECR repository for AWS Loadbalancer Controller for region " + region + ". Using default helm image.");
        return {};
    }
    return { image: { repository: registry + "amazon/aws-load-balancer-controller" } };
}
let AwsLoadBalancerControllerAddOn = class AwsLoadBalancerControllerAddOn extends helm_addon_1.HelmAddOn {
    constructor(props) {
        super({ ...defaultProps, ...props });
        this.options = this.props;
    }
    deploy(clusterInfo) {
        const cluster = clusterInfo.cluster;
        const serviceAccount = cluster.addServiceAccount("aws-load-balancer-controller", {
            name: AWS_LOAD_BALANCER_CONTROLLER,
            namespace: this.options.namespace,
        });
        (0, iam_policy_1.AwsLoadbalancerControllerIamPolicy)(cluster.stack.partition).Statement.forEach((statement) => {
            serviceAccount.addToPrincipalPolicy(iam.PolicyStatement.fromJson(statement));
        });
        const registry = registry_utils_1.registries.get(cluster.stack.region);
        const image = lookupImage(registry, cluster.stack.region);
        const awsLoadBalancerControllerChart = this.addHelmChart(clusterInfo, {
            clusterName: cluster.clusterName,
            serviceAccount: {
                create: false,
                name: serviceAccount.serviceAccountName,
            },
            // must disable waf features for aws-cn partition
            enableShield: this.options.enableShield,
            enableWaf: this.options.enableWaf,
            enableWafv2: this.options.enableWafv2,
            createIngressClassResource: this.options.createIngressClassResource,
            ingressClass: this.options.ingressClass,
            enableServiceMutatorWebhook: this.options.enableServiceMutatorWebhook,
            region: clusterInfo.cluster.stack.region,
            ...image,
            vpcId: clusterInfo.cluster.vpc.vpcId,
            ...this.options.values,
        }, undefined, true, aws_cdk_lib_1.Duration.minutes(15));
        awsLoadBalancerControllerChart.node.addDependency(serviceAccount);
        // return the Promise Construct for any teams that may depend on this
        return Promise.resolve(awsLoadBalancerControllerChart);
    }
};
exports.AwsLoadBalancerControllerAddOn = AwsLoadBalancerControllerAddOn;
__decorate([
    utils.conflictsWithAutoMode(null)
], AwsLoadBalancerControllerAddOn.prototype, "deploy", null);
exports.AwsLoadBalancerControllerAddOn = AwsLoadBalancerControllerAddOn = __decorate([
    utils.supportsALL
], AwsLoadBalancerControllerAddOn);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9saWIvYWRkb25zL2F3cy1sb2FkYmFsYW5jZXItY29udHJvbGxlci9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSwyQ0FBMkM7QUFFM0MsNEJBQTBCO0FBRTFCLCtEQUF3RDtBQUN4RCw4Q0FBOEQ7QUFDOUQsNkNBQWtFO0FBQ2xFLDZDQUF1QztBQUN2QyxxQ0FBcUM7QUEwQ3JDLE1BQU0sNEJBQTRCLEdBQUcsOEJBQThCLENBQUM7QUFFcEU7O0dBRUc7QUFDSCxNQUFNLFlBQVksR0FBbUM7SUFDakQsSUFBSSxFQUFFLDRCQUE0QjtJQUNsQyxTQUFTLEVBQUUsYUFBYTtJQUN4QixLQUFLLEVBQUUsNEJBQTRCO0lBQ25DLFVBQVUsRUFBRSxrQ0FBa0M7SUFDOUMsT0FBTyxFQUFFLDRCQUE0QjtJQUNyQyxPQUFPLEVBQUUsUUFBUTtJQUNqQixZQUFZLEVBQUUsS0FBSztJQUNuQixTQUFTLEVBQUUsS0FBSztJQUNoQixXQUFXLEVBQUUsS0FBSztJQUNsQiwwQkFBMEIsRUFBRSxJQUFJO0lBQ2hDLFlBQVksRUFBRSxLQUFLO0lBQ25CLDJCQUEyQixFQUFFLEtBQUs7Q0FDckMsQ0FBQztBQUdGLFNBQVMsV0FBVyxDQUFDLFFBQWlCLEVBQUUsTUFBZTtJQUNuRCxJQUFJLFFBQVEsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUNuQixPQUFPLENBQUMsR0FBRyxDQUFDLDBFQUEwRSxHQUFHLE1BQU0sR0FBRyw2QkFBNkIsQ0FBQyxDQUFDO1FBQ2pJLE9BQU8sRUFBRSxDQUFDO0lBQ2QsQ0FBQztJQUVELE9BQU8sRUFBRSxLQUFLLEVBQUUsRUFBRSxVQUFVLEVBQUUsUUFBUSxHQUFHLHFDQUFxQyxFQUFFLEVBQUUsQ0FBQztBQUN2RixDQUFDO0FBR00sSUFBTSw4QkFBOEIsR0FBcEMsTUFBTSw4QkFBK0IsU0FBUSxzQkFBUztJQUd6RCxZQUFZLEtBQXNDO1FBQzlDLEtBQUssQ0FBQyxFQUFFLEdBQUksWUFBb0IsRUFBRSxHQUFHLEtBQUssRUFBRSxDQUFDLENBQUM7UUFDOUMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBdUMsQ0FBQztJQUNoRSxDQUFDO0lBR0QsTUFBTSxDQUFDLFdBQXdCO1FBQzNCLE1BQU0sT0FBTyxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUM7UUFDcEMsTUFBTSxjQUFjLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUM1Qyw4QkFBOEIsRUFDOUI7WUFDSSxJQUFJLEVBQUUsNEJBQTRCO1lBQ2xDLFNBQVMsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVM7U0FDcEMsQ0FDSixDQUFDO1FBRUYsSUFBQSwrQ0FBa0MsRUFDOUIsT0FBTyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQzFCLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsRUFBRSxFQUFFO1lBQzlCLGNBQWMsQ0FBQyxvQkFBb0IsQ0FDL0IsR0FBRyxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQzFDLENBQUM7UUFDTixDQUFDLENBQUMsQ0FBQztRQUVILE1BQU0sUUFBUSxHQUFHLDJCQUFVLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFdEQsTUFBTSxLQUFLLEdBQUcsV0FBVyxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRzFELE1BQU0sOEJBQThCLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUU7WUFDbEUsV0FBVyxFQUFFLE9BQU8sQ0FBQyxXQUFXO1lBQ2hDLGNBQWMsRUFBRTtnQkFDWixNQUFNLEVBQUUsS0FBSztnQkFDYixJQUFJLEVBQUUsY0FBYyxDQUFDLGtCQUFrQjthQUMxQztZQUNELGlEQUFpRDtZQUNqRCxZQUFZLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZO1lBQ3ZDLFNBQVMsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVM7WUFDakMsV0FBVyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVztZQUNyQywwQkFBMEIsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLDBCQUEwQjtZQUNuRSxZQUFZLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZO1lBQ3ZDLDJCQUEyQixFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsMkJBQTJCO1lBQ3JFLE1BQU0sRUFBRSxXQUFXLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNO1lBQ3hDLEdBQUcsS0FBSztZQUNSLEtBQUssRUFBRSxXQUFXLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLO1lBQ3BDLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNO1NBQ3pCLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxzQkFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRTFDLDhCQUE4QixDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDbEUscUVBQXFFO1FBQ3JFLE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0lBQzNELENBQUM7Q0FDSixDQUFBO0FBdkRZLHdFQUE4QjtBQVN2QztJQURDLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUM7NERBOENqQzt5Q0F0RFEsOEJBQThCO0lBRDFDLEtBQUssQ0FBQyxXQUFXO0dBQ0wsOEJBQThCLENBdUQxQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGlhbSBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWlhbVwiO1xuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSBcImNvbnN0cnVjdHNcIjtcbmltcG9ydCBcInJlZmxlY3QtbWV0YWRhdGFcIjtcbmltcG9ydCB7IENsdXN0ZXJJbmZvLCBWYWx1ZXMgfSBmcm9tIFwiLi4vLi4vc3BpXCI7XG5pbXBvcnQgeyByZWdpc3RyaWVzIH0gZnJvbSBcIi4uLy4uL3V0aWxzL3JlZ2lzdHJ5LXV0aWxzXCI7XG5pbXBvcnQgeyBIZWxtQWRkT24sIEhlbG1BZGRPblVzZXJQcm9wcyB9IGZyb20gXCIuLi9oZWxtLWFkZG9uXCI7XG5pbXBvcnQgeyBBd3NMb2FkYmFsYW5jZXJDb250cm9sbGVySWFtUG9saWN5IH0gZnJvbSBcIi4vaWFtLXBvbGljeVwiO1xuaW1wb3J0IHsgRHVyYXRpb24gfSBmcm9tIFwiYXdzLWNkay1saWJcIjtcbmltcG9ydCAqIGFzIHV0aWxzIGZyb20gXCIuLi8uLi91dGlsc1wiO1xuXG5cbi8qKlxuICogQ29uZmlndXJhdGlvbiBvcHRpb25zIGZvciB0aGUgYWRkLW9uLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEF3c0xvYWRCYWxhbmNlckNvbnRyb2xsZXJQcm9wcyBleHRlbmRzIEhlbG1BZGRPblVzZXJQcm9wcyB7XG5cbiAgICAvKipcbiAgICAgKiBFbmFibGUgU2hpZWxkIChtdXN0IGJlIGZhbHNlIGZvciBDTiBwYXJ0aXRpb24pXG4gICAgICovXG4gICAgZW5hYmxlU2hpZWxkPzogYm9vbGVhbixcblxuICAgIC8qKlxuICAgICAqIEVuYWJsZSBXQUYgKG11c3QgYmUgZmFsc2UgZm9yIENOIHBhcnRpdGlvbilcbiAgICAgKi9cbiAgICBlbmFibGVXYWY/OiBib29sZWFuLFxuXG4gICAgLyoqXG4gICAgICogRW5hYmxlIFdBRlYyIChtdXN0IGJlIGZhbHNlIGZvciBDTiBwYXJ0aXRpb24pXG4gICAgICovXG4gICAgZW5hYmxlV2FmdjI/OiBib29sZWFuLFxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIHRoZSBpbmdyZXNzQ2xhc3MgdG8gYmUgdXNlZCBieSB0aGUgQUxCIGNvbnRyb2xsZXJcbiAgICAgKi9cbiAgICBjcmVhdGVJbmdyZXNzQ2xhc3NSZXNvdXJjZT86IGJvb2xlYW5cblxuICAgIC8qKlxuICAgICAqIE5hbWUgb2YgaW5ncmVzc0NsYXNzIHRvIHRoZSBBTEIgY29udHJvbGxlciB3aWxsIHNhdGlzZnkuIElmIG5vdCBwcm92aWRlZFxuICAgICAqIHRoZSB2YWx1ZSB3aWxsIGJlIGRlZmF1bHRlZCB0byBcImFsYlwiXG4gICAgICovXG4gICAgaW5ncmVzc0NsYXNzPzogc3RyaW5nLFxuXG4gICAgLyoqXG4gICAgICogSWYgZmFsc2UsIGRpc2FibGUgdGhlIFNlcnZpY2UgTXV0YXRvciB3ZWJob29rIHdoaWNoIG1ha2VzIGFsbCBuZXcgc2VydmljZXMgb2YgdHlwZSBMb2FkQmFsYW5jZXIgcmVjb25jaWxlZCBieSB0aGUgbGIgY29udHJvbGxlci5cbiAgICAgKiBAZGVmYXVsdCBmYWxzZSAgIFxuICAgICAqL1xuICAgIGVuYWJsZVNlcnZpY2VNdXRhdG9yV2ViaG9vaz86IGJvb2xlYW5cbn1cblxuXG5jb25zdCBBV1NfTE9BRF9CQUxBTkNFUl9DT05UUk9MTEVSID0gJ2F3cy1sb2FkLWJhbGFuY2VyLWNvbnRyb2xsZXInO1xuXG4vKipcbiAqIERlZmF1bHRzIG9wdGlvbnMgZm9yIHRoZSBhZGQtb25cbiAqL1xuY29uc3QgZGVmYXVsdFByb3BzOiBBd3NMb2FkQmFsYW5jZXJDb250cm9sbGVyUHJvcHMgPSB7XG4gICAgbmFtZTogQVdTX0xPQURfQkFMQU5DRVJfQ09OVFJPTExFUixcbiAgICBuYW1lc3BhY2U6ICdrdWJlLXN5c3RlbScsXG4gICAgY2hhcnQ6IEFXU19MT0FEX0JBTEFOQ0VSX0NPTlRST0xMRVIsXG4gICAgcmVwb3NpdG9yeTogJ2h0dHBzOi8vYXdzLmdpdGh1Yi5pby9la3MtY2hhcnRzJyxcbiAgICByZWxlYXNlOiBBV1NfTE9BRF9CQUxBTkNFUl9DT05UUk9MTEVSLFxuICAgIHZlcnNpb246ICcxLjEyLjAnLFxuICAgIGVuYWJsZVNoaWVsZDogZmFsc2UsXG4gICAgZW5hYmxlV2FmOiBmYWxzZSxcbiAgICBlbmFibGVXYWZ2MjogZmFsc2UsXG4gICAgY3JlYXRlSW5ncmVzc0NsYXNzUmVzb3VyY2U6IHRydWUsXG4gICAgaW5ncmVzc0NsYXNzOiBcImFsYlwiLFxuICAgIGVuYWJsZVNlcnZpY2VNdXRhdG9yV2ViaG9vazogZmFsc2Vcbn07XG5cblxuZnVuY3Rpb24gbG9va3VwSW1hZ2UocmVnaXN0cnk/OiBzdHJpbmcsIHJlZ2lvbj86IHN0cmluZyk6IFZhbHVlcyB7XG4gICAgaWYgKHJlZ2lzdHJ5ID09IG51bGwpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJVbmFibGUgdG8gZ2V0IEVDUiByZXBvc2l0b3J5IGZvciBBV1MgTG9hZGJhbGFuY2VyIENvbnRyb2xsZXIgZm9yIHJlZ2lvbiBcIiArIHJlZ2lvbiArIFwiLiBVc2luZyBkZWZhdWx0IGhlbG0gaW1hZ2UuXCIpO1xuICAgICAgICByZXR1cm4ge307XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgaW1hZ2U6IHsgcmVwb3NpdG9yeTogcmVnaXN0cnkgKyBcImFtYXpvbi9hd3MtbG9hZC1iYWxhbmNlci1jb250cm9sbGVyXCIgfSB9O1xufVxuXG5AdXRpbHMuc3VwcG9ydHNBTExcbmV4cG9ydCBjbGFzcyBBd3NMb2FkQmFsYW5jZXJDb250cm9sbGVyQWRkT24gZXh0ZW5kcyBIZWxtQWRkT24ge1xuICAgIHJlYWRvbmx5IG9wdGlvbnM6IEF3c0xvYWRCYWxhbmNlckNvbnRyb2xsZXJQcm9wcztcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzPzogQXdzTG9hZEJhbGFuY2VyQ29udHJvbGxlclByb3BzKSB7XG4gICAgICAgIHN1cGVyKHsgLi4uKGRlZmF1bHRQcm9wcyBhcyBhbnkpLCAuLi5wcm9wcyB9KTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gdGhpcy5wcm9wcyBhcyBBd3NMb2FkQmFsYW5jZXJDb250cm9sbGVyUHJvcHM7XG4gICAgfVxuXG4gICAgQHV0aWxzLmNvbmZsaWN0c1dpdGhBdXRvTW9kZShudWxsKVxuICAgIGRlcGxveShjbHVzdGVySW5mbzogQ2x1c3RlckluZm8pOiBQcm9taXNlPENvbnN0cnVjdD4ge1xuICAgICAgICBjb25zdCBjbHVzdGVyID0gY2x1c3RlckluZm8uY2x1c3RlcjtcbiAgICAgICAgY29uc3Qgc2VydmljZUFjY291bnQgPSBjbHVzdGVyLmFkZFNlcnZpY2VBY2NvdW50KFxuICAgICAgICAgICAgXCJhd3MtbG9hZC1iYWxhbmNlci1jb250cm9sbGVyXCIsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogQVdTX0xPQURfQkFMQU5DRVJfQ09OVFJPTExFUixcbiAgICAgICAgICAgICAgICBuYW1lc3BhY2U6IHRoaXMub3B0aW9ucy5uYW1lc3BhY2UsXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgQXdzTG9hZGJhbGFuY2VyQ29udHJvbGxlcklhbVBvbGljeShcbiAgICAgICAgICAgIGNsdXN0ZXIuc3RhY2sucGFydGl0aW9uXG4gICAgICAgICkuU3RhdGVtZW50LmZvckVhY2goKHN0YXRlbWVudCkgPT4ge1xuICAgICAgICAgICAgc2VydmljZUFjY291bnQuYWRkVG9QcmluY2lwYWxQb2xpY3koXG4gICAgICAgICAgICAgICAgaWFtLlBvbGljeVN0YXRlbWVudC5mcm9tSnNvbihzdGF0ZW1lbnQpXG4gICAgICAgICAgICApO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCByZWdpc3RyeSA9IHJlZ2lzdHJpZXMuZ2V0KGNsdXN0ZXIuc3RhY2sucmVnaW9uKTtcblxuICAgICAgICBjb25zdCBpbWFnZSA9IGxvb2t1cEltYWdlKHJlZ2lzdHJ5LCBjbHVzdGVyLnN0YWNrLnJlZ2lvbik7XG5cblxuICAgICAgICBjb25zdCBhd3NMb2FkQmFsYW5jZXJDb250cm9sbGVyQ2hhcnQgPSB0aGlzLmFkZEhlbG1DaGFydChjbHVzdGVySW5mbywge1xuICAgICAgICAgICAgY2x1c3Rlck5hbWU6IGNsdXN0ZXIuY2x1c3Rlck5hbWUsXG4gICAgICAgICAgICBzZXJ2aWNlQWNjb3VudDoge1xuICAgICAgICAgICAgICAgIGNyZWF0ZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgbmFtZTogc2VydmljZUFjY291bnQuc2VydmljZUFjY291bnROYW1lLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIG11c3QgZGlzYWJsZSB3YWYgZmVhdHVyZXMgZm9yIGF3cy1jbiBwYXJ0aXRpb25cbiAgICAgICAgICAgIGVuYWJsZVNoaWVsZDogdGhpcy5vcHRpb25zLmVuYWJsZVNoaWVsZCxcbiAgICAgICAgICAgIGVuYWJsZVdhZjogdGhpcy5vcHRpb25zLmVuYWJsZVdhZixcbiAgICAgICAgICAgIGVuYWJsZVdhZnYyOiB0aGlzLm9wdGlvbnMuZW5hYmxlV2FmdjIsXG4gICAgICAgICAgICBjcmVhdGVJbmdyZXNzQ2xhc3NSZXNvdXJjZTogdGhpcy5vcHRpb25zLmNyZWF0ZUluZ3Jlc3NDbGFzc1Jlc291cmNlLFxuICAgICAgICAgICAgaW5ncmVzc0NsYXNzOiB0aGlzLm9wdGlvbnMuaW5ncmVzc0NsYXNzLFxuICAgICAgICAgICAgZW5hYmxlU2VydmljZU11dGF0b3JXZWJob29rOiB0aGlzLm9wdGlvbnMuZW5hYmxlU2VydmljZU11dGF0b3JXZWJob29rLFxuICAgICAgICAgICAgcmVnaW9uOiBjbHVzdGVySW5mby5jbHVzdGVyLnN0YWNrLnJlZ2lvbixcbiAgICAgICAgICAgIC4uLmltYWdlLFxuICAgICAgICAgICAgdnBjSWQ6IGNsdXN0ZXJJbmZvLmNsdXN0ZXIudnBjLnZwY0lkLFxuICAgICAgICAgICAgLi4udGhpcy5vcHRpb25zLnZhbHVlcyxcbiAgICAgICAgfSwgdW5kZWZpbmVkLCB0cnVlLCBEdXJhdGlvbi5taW51dGVzKDE1KSk7XG5cbiAgICAgICAgYXdzTG9hZEJhbGFuY2VyQ29udHJvbGxlckNoYXJ0Lm5vZGUuYWRkRGVwZW5kZW5jeShzZXJ2aWNlQWNjb3VudCk7XG4gICAgICAgIC8vIHJldHVybiB0aGUgUHJvbWlzZSBDb25zdHJ1Y3QgZm9yIGFueSB0ZWFtcyB0aGF0IG1heSBkZXBlbmQgb24gdGhpc1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGF3c0xvYWRCYWxhbmNlckNvbnRyb2xsZXJDaGFydCk7XG4gICAgfVxufVxuIl19