"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.EfsCsiDriverAddOn = void 0;
const helm_addon_1 = require("../helm-addon");
const iam_policy_1 = require("./iam-policy");
const registry_utils_1 = require("../../utils/registry-utils");
const iam = require("aws-cdk-lib/aws-iam");
const utils_1 = require("../../utils");
const EFS_CSI_DRIVER = "aws-efs-csi-driver";
const EFS_CSI_CONTROLLER_SA = "efs-csi-controller-sa";
const EFS_REGISTRY_SUFFIX = "eks/aws-efs-csi-driver";
/**
 * Defaults options for the add-on
 */
const defaultProps = {
    version: '3.1.8',
    namespace: "kube-system",
    repository: "https://kubernetes-sigs.github.io/aws-efs-csi-driver/",
    name: EFS_CSI_DRIVER,
    chart: EFS_CSI_DRIVER,
    replicaCount: 2,
    createNamespace: false
};
let EfsCsiDriverAddOn = class EfsCsiDriverAddOn extends helm_addon_1.HelmAddOn {
    constructor(props) {
        super({ ...defaultProps, ...props });
        this.options = this.props;
    }
    deploy(clusterInfo) {
        var _a;
        // Create service account and policy
        const cluster = clusterInfo.cluster;
        const serviceAccount = cluster.addServiceAccount(EFS_CSI_CONTROLLER_SA, {
            name: EFS_CSI_CONTROLLER_SA,
            namespace: this.options.namespace,
        });
        (0, iam_policy_1.getEfsDriverPolicyStatements)((_a = this.options) === null || _a === void 0 ? void 0 : _a.kmsKeys).forEach((statement) => {
            serviceAccount.addToPrincipalPolicy(iam.PolicyStatement.fromJson(statement));
        });
        // Create namespace
        if (this.options.createNamespace) {
            const ns = (0, utils_1.createNamespace)(this.options.namespace, cluster, true);
            serviceAccount.node.addDependency(ns);
        }
        // Lookup appropriate image repo
        const repo = registry_utils_1.registries.get(clusterInfo.cluster.stack.region) + EFS_REGISTRY_SUFFIX;
        // setup value for helm chart
        const chartValues = populateValues(this.options, cluster.clusterName, serviceAccount.serviceAccountName, repo);
        // Define chart
        const efsCsiDriverChart = this.addHelmChart(clusterInfo, chartValues);
        efsCsiDriverChart.node.addDependency(serviceAccount);
        // return the Promise Construct for any teams that may depend on this
        return Promise.resolve(efsCsiDriverChart);
    }
};
exports.EfsCsiDriverAddOn = EfsCsiDriverAddOn;
exports.EfsCsiDriverAddOn = EfsCsiDriverAddOn = __decorate([
    utils_1.supportsALL
], EfsCsiDriverAddOn);
/**
 * populateValues populates the appropriate values used to customize the Helm chart
 * @param helmOptions User provided values to customize the chart
 * @param clusterName Name of the cluster where to deploy the add-on
 * @param serviceAccountName Name of the service account used by the add-on
 * @param repository Repository to pull image for Add_on
 */
function populateValues(helmOptions, clusterName, serviceAccountName, repository) {
    var _a;
    const values = (_a = helmOptions.values) !== null && _a !== void 0 ? _a : {};
    (0, utils_1.setPath)(values, "clusterName", clusterName);
    (0, utils_1.setPath)(values, "controller.serviceAccount.create", false);
    (0, utils_1.setPath)(values, "controller.serviceAccount.name", serviceAccountName);
    (0, utils_1.setPath)(values, "node.serviceAccount.create", false);
    (0, utils_1.setPath)(values, "node.serviceAccount.name", serviceAccountName);
    (0, utils_1.setPath)(values, "replicaCount", helmOptions.replicaCount);
    (0, utils_1.setPath)(values, "image.repository", repository);
    return values;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9saWIvYWRkb25zL2Vmcy1jc2ktZHJpdmVyL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUVBLDhDQUE4RDtBQUM5RCw2Q0FBNEQ7QUFDNUQsK0RBQXlEO0FBQ3pELDJDQUEyQztBQUMzQyx1Q0FBbUU7QUFJbkUsTUFBTSxjQUFjLEdBQUcsb0JBQW9CLENBQUM7QUFDNUMsTUFBTSxxQkFBcUIsR0FBRyx1QkFBdUIsQ0FBQztBQUN0RCxNQUFNLG1CQUFtQixHQUFHLHdCQUF3QixDQUFDO0FBNEJyRDs7R0FFRztBQUNILE1BQU0sWUFBWSxHQUFzQjtJQUNwQyxPQUFPLEVBQUUsT0FBTztJQUNoQixTQUFTLEVBQUUsYUFBYTtJQUN4QixVQUFVLEVBQUUsdURBQXVEO0lBQ25FLElBQUksRUFBRSxjQUFjO0lBQ3BCLEtBQUssRUFBRSxjQUFjO0lBQ3JCLFlBQVksRUFBRSxDQUFDO0lBQ2YsZUFBZSxFQUFFLEtBQUs7Q0FDekIsQ0FBQztBQUdLLElBQU0saUJBQWlCLEdBQXZCLE1BQU0saUJBQWtCLFNBQVEsc0JBQVM7SUFJNUMsWUFBWSxLQUF5QjtRQUNqQyxLQUFLLENBQUMsRUFBRSxHQUFHLFlBQW1CLEVBQUUsR0FBRyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBQzVDLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQTBCLENBQUM7SUFDbkQsQ0FBQztJQUVELE1BQU0sQ0FBQyxXQUF3Qjs7UUFDM0Isb0NBQW9DO1FBQ3BDLE1BQU0sT0FBTyxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUM7UUFDcEMsTUFBTSxjQUFjLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUFDLHFCQUFxQixFQUFFO1lBQ3BFLElBQUksRUFBRSxxQkFBcUI7WUFDM0IsU0FBUyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUztTQUNwQyxDQUFDLENBQUM7UUFFSCxJQUFBLHlDQUE0QixFQUFDLE1BQUEsSUFBSSxDQUFDLE9BQU8sMENBQUUsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxFQUFFLEVBQUU7WUFDdEUsY0FBYyxDQUFDLG9CQUFvQixDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDakYsQ0FBQyxDQUFDLENBQUM7UUFFSyxtQkFBbUI7UUFDM0IsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQy9CLE1BQU0sRUFBRSxHQUFHLElBQUEsdUJBQWUsRUFBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVUsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDbkUsY0FBYyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDMUMsQ0FBQztRQUVELGdDQUFnQztRQUNoQyxNQUFNLElBQUksR0FBRywyQkFBVSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxtQkFBbUIsQ0FBQztRQUNwRiw2QkFBNkI7UUFDN0IsTUFBTSxXQUFXLEdBQUcsY0FBYyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLFdBQVcsRUFBRSxjQUFjLENBQUMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFFL0csZUFBZTtRQUNmLE1BQU0saUJBQWlCLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFFdEUsaUJBQWlCLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUNyRCxxRUFBcUU7UUFDckUsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUM7SUFDOUMsQ0FBQztDQUNKLENBQUE7QUF2Q1ksOENBQWlCOzRCQUFqQixpQkFBaUI7SUFEN0IsbUJBQVc7R0FDQyxpQkFBaUIsQ0F1QzdCO0FBRUQ7Ozs7OztHQU1HO0FBQ0gsU0FBUyxjQUFjLENBQUMsV0FBOEIsRUFBRSxXQUFtQixFQUNuRCxrQkFBMEIsRUFBRSxVQUFrQjs7SUFDbEUsTUFBTSxNQUFNLEdBQUcsTUFBQSxXQUFXLENBQUMsTUFBTSxtQ0FBSSxFQUFFLENBQUM7SUFFeEMsSUFBQSxlQUFPLEVBQUMsTUFBTSxFQUFFLGFBQWEsRUFBRyxXQUFXLENBQUMsQ0FBQztJQUM3QyxJQUFBLGVBQU8sRUFBQyxNQUFNLEVBQUUsa0NBQWtDLEVBQUcsS0FBSyxDQUFDLENBQUM7SUFDNUQsSUFBQSxlQUFPLEVBQUMsTUFBTSxFQUFFLGdDQUFnQyxFQUFHLGtCQUFrQixDQUFDLENBQUM7SUFDdkUsSUFBQSxlQUFPLEVBQUMsTUFBTSxFQUFFLDRCQUE0QixFQUFHLEtBQUssQ0FBQyxDQUFDO0lBQ3RELElBQUEsZUFBTyxFQUFDLE1BQU0sRUFBRSwwQkFBMEIsRUFBRyxrQkFBa0IsQ0FBQyxDQUFDO0lBQ2pFLElBQUEsZUFBTyxFQUFDLE1BQU0sRUFBRSxjQUFjLEVBQUcsV0FBVyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzNELElBQUEsZUFBTyxFQUFDLE1BQU0sRUFBRSxrQkFBa0IsRUFBRyxVQUFVLENBQUMsQ0FBQztJQUVqRCxPQUFPLE1BQU0sQ0FBQztBQUNsQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSBcImNvbnN0cnVjdHNcIjtcbmltcG9ydCB7IENsdXN0ZXJJbmZvLCBWYWx1ZXN9IGZyb20gXCIuLi8uLi9zcGlcIjtcbmltcG9ydCB7IEhlbG1BZGRPbiwgSGVsbUFkZE9uVXNlclByb3BzIH0gZnJvbSBcIi4uL2hlbG0tYWRkb25cIjtcbmltcG9ydCB7IGdldEVmc0RyaXZlclBvbGljeVN0YXRlbWVudHMgfSBmcm9tIFwiLi9pYW0tcG9saWN5XCI7XG5pbXBvcnQgeyByZWdpc3RyaWVzIH0gIGZyb20gXCIuLi8uLi91dGlscy9yZWdpc3RyeS11dGlsc1wiO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtaWFtXCI7XG5pbXBvcnQgeyBjcmVhdGVOYW1lc3BhY2UsIHNldFBhdGgsIHN1cHBvcnRzQUxMfSBmcm9tIFwiLi4vLi4vdXRpbHNcIjtcbmltcG9ydCAqIGFzIGttcyBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWttc1wiO1xuXG5cbmNvbnN0IEVGU19DU0lfRFJJVkVSID0gXCJhd3MtZWZzLWNzaS1kcml2ZXJcIjtcbmNvbnN0IEVGU19DU0lfQ09OVFJPTExFUl9TQSA9IFwiZWZzLWNzaS1jb250cm9sbGVyLXNhXCI7XG5jb25zdCBFRlNfUkVHSVNUUllfU1VGRklYID0gXCJla3MvYXdzLWVmcy1jc2ktZHJpdmVyXCI7XG5cbi8qKlxuICogQ29uZmlndXJhdGlvbiBvcHRpb25zIGZvciB0aGUgYWRkLW9uLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEVmc0NzaURyaXZlclByb3BzIGV4dGVuZHMgSGVsbUFkZE9uVXNlclByb3BzIHtcbiAgICAvKipcbiAgICAgKiBWZXJzaW9uIG9mIHRoZSBkcml2ZXIgdG8gZGVwbG95LiBVc2VzIGNoYXJ0IHZlcnNpb24gMi4yLjMgYnkgZGVmYXVsdCBpZiB0aGlzIHZhbHVlIGlzIG5vdCBwcm92aWRlZFxuICAgICAqL1xuICAgIHZlcnNpb24/OiBzdHJpbmcsXG4gICAgLyoqKlxuICAgICAqIE51bWJlciBvZiByZXBsaWNhcyB0byBiZSBkZXBsb3llZC4gSWYgbm90IHByb3ZpZGVkLCBpdCBkZWZhdWx0cyB0byAyLiBOb3RlIHRoYXQgdGhlIG51bWJlciBvZiByZXBsaWNhc1xuICAgICAqIHNob3VsZCBiZSBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gdGhlIG51bWJlciBvZiBub2RlcyBpbiB0aGUgY2x1c3RlciBvdGhlcndpc2Ugc29tZVxuICAgICAqIHBvZHMgd2lsbCBiZSBsZWZ0IG9mIHBlbmRpbmcgc3RhdGVcbiAgICAgKi9cbiAgICByZXBsaWNhQ291bnQ/OiBudW1iZXJcbiAgICAvKipcbiAgICAgKiBMaXN0IG9mIEtNUyBrZXlzIHRvIGJlIHVzZWQgZm9yIGVuY3J5cHRpb25cbiAgICAgKi9cbiAgICBrbXNLZXlzPzoga21zLktleVtdO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIE5hbWVzcGFjZSB3aXRoIHRoZSBwcm92aWRlZCBvbmUgKHdpbGwgbm90IGlmIG5hbWVzcGFjZSBpcyBrdWJlLXN5c3RlbSlcbiAgICAgKi9cbiAgICBjcmVhdGVOYW1lc3BhY2U/OiBib29sZWFuXG5cbn1cblxuLyoqXG4gKiBEZWZhdWx0cyBvcHRpb25zIGZvciB0aGUgYWRkLW9uXG4gKi9cbmNvbnN0IGRlZmF1bHRQcm9wczogRWZzQ3NpRHJpdmVyUHJvcHMgPSB7XG4gICAgdmVyc2lvbjogJzMuMS44JyxcbiAgICBuYW1lc3BhY2U6IFwia3ViZS1zeXN0ZW1cIixcbiAgICByZXBvc2l0b3J5OiBcImh0dHBzOi8va3ViZXJuZXRlcy1zaWdzLmdpdGh1Yi5pby9hd3MtZWZzLWNzaS1kcml2ZXIvXCIsXG4gICAgbmFtZTogRUZTX0NTSV9EUklWRVIsXG4gICAgY2hhcnQ6IEVGU19DU0lfRFJJVkVSLFxuICAgIHJlcGxpY2FDb3VudDogMixcbiAgICBjcmVhdGVOYW1lc3BhY2U6IGZhbHNlXG59O1xuXG5Ac3VwcG9ydHNBTExcbmV4cG9ydCBjbGFzcyBFZnNDc2lEcml2ZXJBZGRPbiBleHRlbmRzIEhlbG1BZGRPbiB7XG5cbiAgICByZWFkb25seSBvcHRpb25zOiBFZnNDc2lEcml2ZXJQcm9wcztcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzPzogRWZzQ3NpRHJpdmVyUHJvcHMpIHtcbiAgICAgICAgc3VwZXIoeyAuLi5kZWZhdWx0UHJvcHMgYXMgYW55LCAuLi5wcm9wcyB9KTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gdGhpcy5wcm9wcyBhcyBFZnNDc2lEcml2ZXJQcm9wcztcbiAgICB9XG5cbiAgICBkZXBsb3koY2x1c3RlckluZm86IENsdXN0ZXJJbmZvKTogUHJvbWlzZTxDb25zdHJ1Y3Q+IHtcbiAgICAgICAgLy8gQ3JlYXRlIHNlcnZpY2UgYWNjb3VudCBhbmQgcG9saWN5XG4gICAgICAgIGNvbnN0IGNsdXN0ZXIgPSBjbHVzdGVySW5mby5jbHVzdGVyO1xuICAgICAgICBjb25zdCBzZXJ2aWNlQWNjb3VudCA9IGNsdXN0ZXIuYWRkU2VydmljZUFjY291bnQoRUZTX0NTSV9DT05UUk9MTEVSX1NBLCB7XG4gICAgICAgICAgICBuYW1lOiBFRlNfQ1NJX0NPTlRST0xMRVJfU0EsXG4gICAgICAgICAgICBuYW1lc3BhY2U6IHRoaXMub3B0aW9ucy5uYW1lc3BhY2UsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGdldEVmc0RyaXZlclBvbGljeVN0YXRlbWVudHModGhpcy5vcHRpb25zPy5rbXNLZXlzKS5mb3JFYWNoKChzdGF0ZW1lbnQpID0+IHtcbiAgICAgICAgICAgIHNlcnZpY2VBY2NvdW50LmFkZFRvUHJpbmNpcGFsUG9saWN5KGlhbS5Qb2xpY3lTdGF0ZW1lbnQuZnJvbUpzb24oc3RhdGVtZW50KSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gQ3JlYXRlIG5hbWVzcGFjZVxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNyZWF0ZU5hbWVzcGFjZSkge1xuICAgICAgICAgICAgY29uc3QgbnMgPSBjcmVhdGVOYW1lc3BhY2UodGhpcy5vcHRpb25zLm5hbWVzcGFjZSEsIGNsdXN0ZXIsIHRydWUpO1xuICAgICAgICAgICAgc2VydmljZUFjY291bnQubm9kZS5hZGREZXBlbmRlbmN5KG5zKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIExvb2t1cCBhcHByb3ByaWF0ZSBpbWFnZSByZXBvXG4gICAgICAgIGNvbnN0IHJlcG8gPSByZWdpc3RyaWVzLmdldChjbHVzdGVySW5mby5jbHVzdGVyLnN0YWNrLnJlZ2lvbikgKyBFRlNfUkVHSVNUUllfU1VGRklYO1xuICAgICAgICAvLyBzZXR1cCB2YWx1ZSBmb3IgaGVsbSBjaGFydFxuICAgICAgICBjb25zdCBjaGFydFZhbHVlcyA9IHBvcHVsYXRlVmFsdWVzKHRoaXMub3B0aW9ucywgY2x1c3Rlci5jbHVzdGVyTmFtZSwgc2VydmljZUFjY291bnQuc2VydmljZUFjY291bnROYW1lLCByZXBvKTtcblxuICAgICAgICAvLyBEZWZpbmUgY2hhcnRcbiAgICAgICAgY29uc3QgZWZzQ3NpRHJpdmVyQ2hhcnQgPSB0aGlzLmFkZEhlbG1DaGFydChjbHVzdGVySW5mbywgY2hhcnRWYWx1ZXMpO1xuXG4gICAgICAgIGVmc0NzaURyaXZlckNoYXJ0Lm5vZGUuYWRkRGVwZW5kZW5jeShzZXJ2aWNlQWNjb3VudCk7XG4gICAgICAgIC8vIHJldHVybiB0aGUgUHJvbWlzZSBDb25zdHJ1Y3QgZm9yIGFueSB0ZWFtcyB0aGF0IG1heSBkZXBlbmQgb24gdGhpc1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGVmc0NzaURyaXZlckNoYXJ0KTtcbiAgICB9XG59XG5cbi8qKlxuICogcG9wdWxhdGVWYWx1ZXMgcG9wdWxhdGVzIHRoZSBhcHByb3ByaWF0ZSB2YWx1ZXMgdXNlZCB0byBjdXN0b21pemUgdGhlIEhlbG0gY2hhcnRcbiAqIEBwYXJhbSBoZWxtT3B0aW9ucyBVc2VyIHByb3ZpZGVkIHZhbHVlcyB0byBjdXN0b21pemUgdGhlIGNoYXJ0XG4gKiBAcGFyYW0gY2x1c3Rlck5hbWUgTmFtZSBvZiB0aGUgY2x1c3RlciB3aGVyZSB0byBkZXBsb3kgdGhlIGFkZC1vblxuICogQHBhcmFtIHNlcnZpY2VBY2NvdW50TmFtZSBOYW1lIG9mIHRoZSBzZXJ2aWNlIGFjY291bnQgdXNlZCBieSB0aGUgYWRkLW9uXG4gKiBAcGFyYW0gcmVwb3NpdG9yeSBSZXBvc2l0b3J5IHRvIHB1bGwgaW1hZ2UgZm9yIEFkZF9vblxuICovXG5mdW5jdGlvbiBwb3B1bGF0ZVZhbHVlcyhoZWxtT3B0aW9uczogRWZzQ3NpRHJpdmVyUHJvcHMsIGNsdXN0ZXJOYW1lOiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlQWNjb3VudE5hbWU6IHN0cmluZywgcmVwb3NpdG9yeTogc3RyaW5nKTogVmFsdWVzIHtcbiAgICBjb25zdCB2YWx1ZXMgPSBoZWxtT3B0aW9ucy52YWx1ZXMgPz8ge307XG5cbiAgICBzZXRQYXRoKHZhbHVlcywgXCJjbHVzdGVyTmFtZVwiLCAgY2x1c3Rlck5hbWUpO1xuICAgIHNldFBhdGgodmFsdWVzLCBcImNvbnRyb2xsZXIuc2VydmljZUFjY291bnQuY3JlYXRlXCIsICBmYWxzZSk7XG4gICAgc2V0UGF0aCh2YWx1ZXMsIFwiY29udHJvbGxlci5zZXJ2aWNlQWNjb3VudC5uYW1lXCIsICBzZXJ2aWNlQWNjb3VudE5hbWUpO1xuICAgIHNldFBhdGgodmFsdWVzLCBcIm5vZGUuc2VydmljZUFjY291bnQuY3JlYXRlXCIsICBmYWxzZSk7XG4gICAgc2V0UGF0aCh2YWx1ZXMsIFwibm9kZS5zZXJ2aWNlQWNjb3VudC5uYW1lXCIsICBzZXJ2aWNlQWNjb3VudE5hbWUpO1xuICAgIHNldFBhdGgodmFsdWVzLCBcInJlcGxpY2FDb3VudFwiLCAgaGVsbU9wdGlvbnMucmVwbGljYUNvdW50KTtcbiAgICBzZXRQYXRoKHZhbHVlcywgXCJpbWFnZS5yZXBvc2l0b3J5XCIsICByZXBvc2l0b3J5KTtcblxuICAgIHJldHVybiB2YWx1ZXM7XG59Il19