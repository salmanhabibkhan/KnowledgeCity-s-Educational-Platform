"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PlatformTeam = exports.ApplicationTeam = exports.TeamProps = void 0;
const aws_cdk_lib_1 = require("aws-cdk-lib");
const aws_eks_1 = require("aws-cdk-lib/aws-eks");
const iam = require("aws-cdk-lib/aws-iam");
const eksv2 = require("@aws-cdk/aws-eks-v2-alpha");
const csi_driver_provider_aws_secrets_1 = require("../addons/secrets-store/csi-driver-provider-aws-secrets");
const yaml_utils_1 = require("../utils/yaml-utils");
const default_team_roles_1 = require("./default-team-roles");
const utils_1 = require("../utils");
/**
 * Team properties.
 */
class TeamProps {
    constructor() {
        /**
         *  Annotations such as necessary for GitOps engine.
         */
        this.namespaceAnnotations = { "argocd.argoproj.io/sync-wave": "-1" };
        /**
         * Optional, but highly recommended setting to ensure predictable demands.
         */
        this.namespaceHardLimits = {
            'requests.cpu': '10', // TODO verify sane defaults
            'requests.memory': '10Gi',
            'limits.cpu': '20',
            'limits.memory': '20Gi'
        };
    }
}
exports.TeamProps = TeamProps;
class ApplicationTeam {
    constructor(teamProps) {
        var _a;
        this.name = teamProps.name;
        this.teamProps = {
            name: teamProps.name,
            namespace: (_a = teamProps.namespace) !== null && _a !== void 0 ? _a : "team-" + teamProps.name,
            users: teamProps.users,
            namespaceAnnotations: teamProps.namespaceAnnotations,
            namespaceLabels: teamProps.namespaceLabels,
            namespaceHardLimits: teamProps.namespaceHardLimits,
            serviceAccountName: teamProps.serviceAccountName,
            serviceAccountPolicies: teamProps.serviceAccountPolicies,
            userRoleArn: teamProps.userRoleArn,
            teamSecrets: teamProps.teamSecrets,
            teamManifestDir: teamProps.teamManifestDir,
            extensionFunction: teamProps.extensionFunction
        };
    }
    setup(clusterInfo) {
        this.defaultSetupAccess(clusterInfo);
        this.setupNamespace(clusterInfo);
        this.setupServiceAccount(clusterInfo);
        this.setupSecrets(clusterInfo);
        if (this.teamProps.extensionFunction) {
            this.teamProps.extensionFunction(this, clusterInfo);
        }
    }
    defaultSetupAccess(clusterInfo) {
        var _a;
        const props = this.teamProps;
        if (!(clusterInfo.cluster instanceof aws_eks_1.Cluster || clusterInfo.clusterv2 instanceof eksv2.Cluster)) {
            utils_1.logger.warn(`Team ${props.name} has cluster access updates that are not supported with imported clusters`);
            return;
        }
        const users = (_a = this.teamProps.users) !== null && _a !== void 0 ? _a : [];
        const teamRole = this.getOrCreateRole(clusterInfo, users, props.userRoleArn);
        if (clusterInfo.clusterv2 instanceof eksv2.Cluster) {
            const eksClusterv2 = clusterInfo.clusterv2;
            if (teamRole) {
                eksClusterv2.grantAccess(props.name + '-access', teamRole.roleArn, [new eksv2.AccessPolicy({
                        accessScope: { type: eksv2.AccessScopeType.NAMESPACE, namespaces: [props.namespace] },
                        policy: eksv2.AccessPolicyArn.AMAZON_EKS_ADMIN_POLICY
                    })]);
            }
        }
        else if (clusterInfo.cluster instanceof aws_eks_1.Cluster) {
            const eksCluster = clusterInfo.cluster;
            const awsAuth = eksCluster.awsAuth;
            if (teamRole) {
                awsAuth.addRoleMapping(teamRole, { groups: [props.namespace + "-team-group"], username: props.name });
            }
        }
        new aws_cdk_lib_1.CfnOutput(clusterInfo.cluster.stack, props.name + ' team role ', { value: teamRole ? teamRole.roleArn : "none" });
    }
    /**
     *
     * @param clusterInfo
     */
    defaultSetupAdminAccess(clusterInfo) {
        var _a;
        const props = this.teamProps;
        if (!(clusterInfo.cluster instanceof aws_eks_1.Cluster || clusterInfo.clusterv2 instanceof eksv2.Cluster)) {
            utils_1.logger.warn(`Team ${props.name} has cluster access updates that are not supported with imported clusters`);
            return;
        }
        const admins = (_a = this.teamProps.users) !== null && _a !== void 0 ? _a : [];
        const adminRole = this.getOrCreateRole(clusterInfo, admins, props.userRoleArn);
        if (clusterInfo.clusterv2 instanceof eksv2.Cluster) {
            const eksClusterv2 = clusterInfo.clusterv2;
            if (adminRole) {
                eksClusterv2.grantAccess(props.name + '-access', adminRole.roleArn, [new eksv2.AccessPolicy({
                        accessScope: { type: eksv2.AccessScopeType.CLUSTER },
                        policy: eksv2.AccessPolicyArn.AMAZON_EKS_CLUSTER_ADMIN_POLICY
                    })]);
            }
        }
        else if (clusterInfo.cluster instanceof aws_eks_1.Cluster) {
            if (adminRole) {
                const eksCluster = clusterInfo.cluster;
                eksCluster.awsAuth.addMastersRole(adminRole, this.teamProps.name);
            }
        }
        new aws_cdk_lib_1.CfnOutput(clusterInfo.cluster.stack, props.name + ' team admin ', { value: adminRole ? adminRole.roleArn : "none" });
    }
    /**
     * Creates a new role with trust relationship or adds trust relationship for an existing role.
     * @param clusterInfo
     * @param users
     * @param role may be null if both role and users were not provided
     * @returns
     */
    getOrCreateRole(clusterInfo, users, roleArn) {
        let role = undefined;
        if (roleArn) {
            role = iam.Role.fromRoleArn(clusterInfo.cluster.stack, `${this.name}-team-role`, roleArn);
            users.forEach(user => role === null || role === void 0 ? void 0 : role.grant(user, "sts:assumeRole"));
        }
        else if (users && users.length > 0) {
            role = new iam.Role(clusterInfo.cluster.stack, this.teamProps.namespace + 'AccessRole', {
                assumedBy: new iam.CompositePrincipal(...users)
            });
            role.addToPrincipalPolicy(new iam.PolicyStatement({
                effect: iam.Effect.ALLOW,
                resources: [clusterInfo.cluster.clusterArn],
                actions: [
                    "eks:DescribeNodegroup",
                    "eks:ListNodegroups",
                    "eks:DescribeCluster",
                    "eks:ListClusters",
                    "eks:AccessKubernetesApi",
                    "ssm:GetParameter",
                    "eks:ListUpdates",
                    "eks:ListFargateProfiles"
                ]
            }));
            role.addToPrincipalPolicy(new iam.PolicyStatement({
                effect: iam.Effect.ALLOW,
                resources: ["*"],
                actions: [
                    "eks:ListClusters"
                ]
            }));
        }
        return role;
    }
    /**
     * Creates namespace and sets up policies.
     * @param clusterInfo
     */
    setupNamespace(clusterInfo) {
        const props = this.teamProps;
        const namespaceName = props.namespace;
        const teamManifestDir = props.teamManifestDir;
        this.namespaceManifest = new aws_eks_1.KubernetesManifest(clusterInfo.cluster.stack, props.name, {
            cluster: clusterInfo.cluster,
            manifest: [{
                    apiVersion: 'v1',
                    kind: 'Namespace',
                    metadata: {
                        name: namespaceName,
                        annotations: props.namespaceAnnotations,
                        labels: props.namespaceLabels
                    }
                }],
            overwrite: true,
            prune: true
        });
        if (props.namespaceHardLimits) {
            this.setupNamespacePolicies(clusterInfo, namespaceName);
        }
        const defaultRoles = new default_team_roles_1.DefaultTeamRoles().createManifest(namespaceName); //TODO: add support for custom RBAC
        const rbacManifest = new aws_eks_1.KubernetesManifest(clusterInfo.cluster.stack, namespaceName + "-rbac", {
            cluster: clusterInfo.cluster,
            manifest: defaultRoles,
            overwrite: true,
            prune: true
        });
        rbacManifest.node.addDependency(this.namespaceManifest);
        if (teamManifestDir) {
            (0, yaml_utils_1.applyYamlFromDir)(teamManifestDir, clusterInfo.cluster, this.namespaceManifest);
        }
    }
    /**
     * Sets up quotas
     * @param clusterInfo
     * @param namespaceName
     */
    setupNamespacePolicies(clusterInfo, namespaceName) {
        const quotaName = this.teamProps.name + "-quota";
        const quotaManifest = clusterInfo.cluster.addManifest(quotaName, {
            apiVersion: 'v1',
            kind: 'ResourceQuota',
            metadata: {
                name: quotaName,
                namespace: namespaceName
            },
            spec: {
                hard: this.teamProps.namespaceHardLimits
            }
        });
        quotaManifest.node.addDependency(this.namespaceManifest);
    }
    /**
     * Sets up ServiceAccount for the team namespace
     * @param clusterInfo
     */
    setupServiceAccount(clusterInfo) {
        const serviceAccountName = this.teamProps.serviceAccountName ? this.teamProps.serviceAccountName : `${this.teamProps.name}-sa`;
        const cluster = clusterInfo.cluster;
        this.serviceAccount = cluster.addServiceAccount(`${this.teamProps.name}-service-account`, {
            name: serviceAccountName,
            namespace: this.teamProps.namespace
        });
        this.serviceAccount.node.addDependency(this.namespaceManifest);
        if (this.teamProps.serviceAccountPolicies) {
            this.teamProps.serviceAccountPolicies.forEach(policy => this.serviceAccount.role.addManagedPolicy(policy));
        }
        const serviceAccountOutput = new aws_cdk_lib_1.CfnOutput(clusterInfo.cluster.stack, `${this.teamProps.name}-sa`, {
            value: serviceAccountName
        });
        serviceAccountOutput.node.addDependency(this.namespaceManifest);
    }
    /**
     * Sets up secrets
     * @param clusterInfo
     */
    setupSecrets(clusterInfo) {
        if (this.teamProps.teamSecrets) {
            const secretProviderClassName = this.teamProps.name + '-aws-secrets';
            new csi_driver_provider_aws_secrets_1.SecretProviderClass(clusterInfo, this.serviceAccount, secretProviderClassName, ...this.teamProps.teamSecrets);
        }
    }
}
exports.ApplicationTeam = ApplicationTeam;
/**
 * Platform team will setup all team members as admin access to the cluster by adding them to the master group.
 * The setup skips namespace/quota configuration.
 */
class PlatformTeam extends ApplicationTeam {
    constructor(teamProps) {
        super(teamProps);
    }
    /**
     * Override
     * @param clusterInfo
     */
    setup(clusterInfo) {
        this.defaultSetupAdminAccess(clusterInfo);
    }
}
exports.PlatformTeam = PlatformTeam;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVhbS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi90ZWFtcy90ZWFtLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDZDQUF3QztBQUN4QyxpREFBa0Y7QUFDbEYsMkNBQTJDO0FBQzNDLG1EQUFtRDtBQUVuRCw2R0FBOEc7QUFFOUcsb0RBQXVEO0FBQ3ZELDZEQUF3RDtBQUN4RCxvQ0FBa0M7QUFFbEM7O0dBRUc7QUFDSCxNQUFhLFNBQVM7SUFBdEI7UUFhSTs7V0FFRztRQUNNLHlCQUFvQixHQUE4QixFQUFFLDhCQUE4QixFQUFFLElBQUksRUFBRSxDQUFDO1FBT3BHOztXQUVHO1FBQ00sd0JBQW1CLEdBQVk7WUFDcEMsY0FBYyxFQUFFLElBQUksRUFBRSw0QkFBNEI7WUFDbEQsaUJBQWlCLEVBQUUsTUFBTTtZQUN6QixZQUFZLEVBQUUsSUFBSTtZQUNsQixlQUFlLEVBQUUsTUFBTTtTQUMxQixDQUFDO0lBMkNOLENBQUM7Q0FBQTtBQTFFRCw4QkEwRUM7QUFFRCxNQUFhLGVBQWU7SUFVeEIsWUFBWSxTQUFvQjs7UUFDNUIsSUFBSSxDQUFDLElBQUksR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDO1FBQzNCLElBQUksQ0FBQyxTQUFTLEdBQUc7WUFDYixJQUFJLEVBQUUsU0FBUyxDQUFDLElBQUk7WUFDcEIsU0FBUyxFQUFFLE1BQUEsU0FBUyxDQUFDLFNBQVMsbUNBQUksT0FBTyxHQUFHLFNBQVMsQ0FBQyxJQUFJO1lBQzFELEtBQUssRUFBRSxTQUFTLENBQUMsS0FBSztZQUN0QixvQkFBb0IsRUFBRSxTQUFTLENBQUMsb0JBQW9CO1lBQ3BELGVBQWUsRUFBRSxTQUFTLENBQUMsZUFBZTtZQUMxQyxtQkFBbUIsRUFBRSxTQUFTLENBQUMsbUJBQW1CO1lBQ2xELGtCQUFrQixFQUFFLFNBQVMsQ0FBQyxrQkFBa0I7WUFDaEQsc0JBQXNCLEVBQUUsU0FBUyxDQUFDLHNCQUFzQjtZQUN4RCxXQUFXLEVBQUUsU0FBUyxD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QU8sQ0FBQyxLQUFLLEVBQUUsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksS0FBSyxFQUFFO1lBQy9GLEtBQUssRUFBRSxrQkFBa0I7U0FDNUIsQ0FBQyxDQUFDO1FBQ0gsb0JBQW9CLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUNwRSxDQUFDO0lBRUQ7OztPQUdHO0lBQ08sWUFBWSxDQUFDLFdBQXdCO1FBQzNDLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUM3QixNQUFNLHVCQUF1QixHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxHQUFHLGNBQWMsQ0FBQztZQUNyRSxJQUFJLHFEQUFtQixDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsY0FBYyxFQUFFLHVCQUF1QixFQUFFLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUN0SCxDQUFDO0lBQ0wsQ0FBQztDQUNKO0FBclBELDBDQXFQQztBQUVEOzs7R0FHRztBQUNILE1BQWEsWUFBYSxTQUFRLGVBQWU7SUFFN0MsWUFBWSxTQUFvQjtRQUM1QixLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDckIsQ0FBQztJQUVEOzs7T0FHRztJQUNILEtBQUssQ0FBQyxXQUF3QjtRQUMxQixJQUFJLENBQUMsdUJBQXVCLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDOUMsQ0FBQztDQUNKO0FBYkQsb0NBYUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDZm5PdXRwdXQgfSBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgeyBDbHVzdGVyLCBLdWJlcm5ldGVzTWFuaWZlc3QsIFNlcnZpY2VBY2NvdW50IH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWVrcyc7XG5pbXBvcnQgKiBhcyBpYW0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWlhbSc7XG5pbXBvcnQgKiBhcyBla3N2MiBmcm9tICdAYXdzLWNkay9hd3MtZWtzLXYyLWFscGhhJztcbmltcG9ydCB7IElSb2xlIH0gZnJvbSBcImF3cy1jZGstbGliL2F3cy1pYW1cIjtcbmltcG9ydCB7IENzaVNlY3JldFByb3BzLCBTZWNyZXRQcm92aWRlckNsYXNzIH0gZnJvbSAnLi4vYWRkb25zL3NlY3JldHMtc3RvcmUvY3NpLWRyaXZlci1wcm92aWRlci1hd3Mtc2VjcmV0cyc7XG5pbXBvcnQgeyBDbHVzdGVySW5mbywgVGVhbSwgVmFsdWVzIH0gZnJvbSAnLi4vc3BpJztcbmltcG9ydCB7IGFwcGx5WWFtbEZyb21EaXIgfSBmcm9tICcuLi91dGlscy95YW1sLXV0aWxzJztcbmltcG9ydCB7IERlZmF1bHRUZWFtUm9sZXMgfSBmcm9tICcuL2RlZmF1bHQtdGVhbS1yb2xlcyc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuLi91dGlscyc7XG5cbi8qKlxuICogVGVhbSBwcm9wZXJ0aWVzLlxuICovXG5leHBvcnQgY2xhc3MgVGVhbVByb3BzIHtcblxuICAgIC8qKlxuICAgICAqIFJlcXVpcmVkIHVuaXF1ZSBuYW1lIGZvciBvcmdhbml6YXRpb24uXG4gICAgICogTWF5IG1hcCB0byBhbiBPVSBuYW1lLiBcbiAgICAgKi9cbiAgICByZWFkb25seSBuYW1lOiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBEZWZhdWx0cyB0byB0ZWFtIG5hbWUgcHJlZml4ZWQgYnkgXCJ0ZWFtLVwiXG4gICAgICovXG4gICAgcmVhZG9ubHkgbmFtZXNwYWNlPzogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICogIEFubm90YXRpb25zIHN1Y2ggYXMgbmVjZXNzYXJ5IGZvciBHaXRPcHMgZW5naW5lLiBcbiAgICAgKi9cbiAgICByZWFkb25seSBuYW1lc3BhY2VBbm5vdGF0aW9ucz8gOiB7IFtrZXk6IHN0cmluZ106IGFueTsgfSA9IHsgXCJhcmdvY2QuYXJnb3Byb2ouaW8vc3luYy13YXZlXCI6IFwiLTFcIiB9O1xuXG4gICAgLyoqXG4gICAgICogTGFiZWxzIHN1Y2ggYXMgbmVjZXNzYXJ5IGZvciBBV1MgQXBwTWVzaCBcbiAgICAgKi9cbiAgICByZWFkb25seSBuYW1lc3BhY2VMYWJlbHM/IDogeyBba2V5OiBzdHJpbmddOiBhbnk7IH07XG5cbiAgICAvKipcbiAgICAgKiBPcHRpb25hbCwgYnV0IGhpZ2hseSByZWNvbW1lbmRlZCBzZXR0aW5nIHRvIGVuc3VyZSBwcmVkaWN0YWJsZSBkZW1hbmRzLlxuICAgICAqL1xuICAgIHJlYWRvbmx5IG5hbWVzcGFjZUhhcmRMaW1pdHM/OiBWYWx1ZXMgPSB7XG4gICAgICAgICdyZXF1ZXN0cy5jcHUnOiAnMTAnLCAvLyBUT0RPIHZlcmlmeSBzYW5lIGRlZmF1bHRzXG4gICAgICAgICdyZXF1ZXN0cy5tZW1vcnknOiAnMTBHaScsXG4gICAgICAgICdsaW1pdHMuY3B1JzogJzIwJyxcbiAgICAgICAgJ2xpbWl0cy5tZW1vcnknOiAnMjBHaSdcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogU2VydmljZSBBY2NvdW50IE5hbWVcbiAgICAgKi9cbiAgICByZWFkb25seSBzZXJ2aWNlQWNjb3VudE5hbWU/OiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBJZiBzcGVjaWZpZWQsIHRoZSBJUlNBIGFjY291bnQgd2lsbCBiZSBjcmVhdGVkIGZvciB3aXRoIHRoZSBJUlNBIHJvbGVcbiAgICAgKiBoYXZpbmcgdGhlIHNwZWNpZmllZCBtYW5hZ2VkIHBvbGljaWVzLiBcbiAgICAgKiBcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIHNlcnZpY2VBY2NvdW50UG9saWNpZXM6IFtNYW5hZ2VkUG9saWN5LmZyb21Bd3NNYW5hZ2VkUG9saWN5TmFtZShcIlwiKV1cbiAgICAgKiBcbiAgICAgKi9cbiAgICByZWFkb25seSBzZXJ2aWNlQWNjb3VudFBvbGljaWVzPzogaWFtLklNYW5hZ2VkUG9saWN5W107XG5cbiAgICAvKipcbiAgICAgKiAgVGVhbSBtZW1iZXJzIHdobyBuZWVkIHRvIGdldCBhY2Nlc3MgdG8gdGhlIGNsdXN0ZXJcbiAgICAgKi9cbiAgICByZWFkb25seSB1c2Vycz86IEFycmF5PGlhbS5Bcm5QcmluY2lwYWw+O1xuXG4gICAgLyoqXG4gICAgICogT3B0aW9ucyBleGlzdGluZyByb2xlIHRoYXQgc2hvdWxkIGJlIHVzZWQgZm9yIGNsdXN0ZXIgYWNjZXNzLiBcbiAgICAgKiBJZiB1c2VyUm9sZSBhbmQgdXNlcnMgYXJlIG5vdCBwcm92aWRlZCwgdGhlbiBubyBJQU0gc2V0dXAgaXMgcGVyZm9ybWVkLiBcbiAgICAgKi9cbiAgICByZWFkb25seSB1c2VyUm9sZUFybj86IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIFRlYW0gU2VjcmV0c1xuICAgICAqL1xuICAgIHJlYWRvbmx5IHRlYW1TZWNyZXRzPzogQ3NpU2VjcmV0UHJvcHNbXTtcblxuICAgIC8qKlxuICAgICAqIE9wdGlvbmFsLCBkaXJlY3Rvcnkgd2hlcmUgYSB0ZWFtJ3MgbWFuaWZlc3RzIGFyZSBzdG9yZWRcbiAgICAgKi9cbiAgICByZWFkb25seSB0ZWFtTWFuaWZlc3REaXI/OiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBPcHRpb25hbCwgVXNlIHRoaXMgZnVuY3Rpb24gdG8gYWRkIGluZnJhc3RydWN0dXJlIG9yIHdvcmtsb2FkcyBcbiAgICAgKiBkZXBsb3ltZW50dG8gdGhlIHRlYW1cbiAgICAqL1xuICAgIGV4dGVuc2lvbkZ1bmN0aW9uPyAodGVhbTogQXBwbGljYXRpb25UZWFtLCBjbHVzdGVySW5mbzogQ2x1c3RlckluZm8pOiB2b2lkO1xufVxuXG5leHBvcnQgY2xhc3MgQXBwbGljYXRpb25UZWFtIGltcGxlbWVudHMgVGVhbSB7XG5cbiAgICByZWFkb25seSB0ZWFtUHJvcHM6IFRlYW1Qcm9wcztcblxuICAgIHJlYWRvbmx5IG5hbWU6IHN0cmluZztcblxuICAgIHB1YmxpYyBuYW1lc3BhY2VNYW5pZmVzdDogS3ViZXJuZXRlc01hbmlmZXN0O1xuXG4gICAgcHVibGljIHNlcnZpY2VBY2NvdW50OiBTZXJ2aWNlQWNjb3VudDtcblxuICAgIGNvbnN0cnVjdG9yKHRlYW1Qcm9wczogVGVhbVByb3BzKSB7XG4gICAgICAgIHRoaXMubmFtZSA9IHRlYW1Qcm9wcy5uYW1lO1xuICAgICAgICB0aGlzLnRlYW1Qcm9wcyA9IHtcbiAgICAgICAgICAgIG5hbWU6IHRlYW1Qcm9wcy5uYW1lLFxuICAgICAgICAgICAgbmFtZXNwYWNlOiB0ZWFtUHJvcHMubmFtZXNwYWNlID8/IFwidGVhbS1cIiArIHRlYW1Qcm9wcy5uYW1lLFxuICAgICAgICAgICAgdXNlcnM6IHRlYW1Qcm9wcy51c2VycyxcbiAgICAgICAgICAgIG5hbWVzcGFjZUFubm90YXRpb25zOiB0ZWFtUHJvcHMubmFtZXNwYWNlQW5ub3RhdGlvbnMsXG4gICAgICAgICAgICBuYW1lc3BhY2VMYWJlbHM6IHRlYW1Qcm9wcy5uYW1lc3BhY2VMYWJlbHMsXG4gICAgICAgICAgICBuYW1lc3BhY2VIYXJkTGltaXRzOiB0ZWFtUHJvcHMubmFtZXNwYWNlSGFyZExpbWl0cyxcbiAgICAgICAgICAgIHNlcnZpY2VBY2NvdW50TmFtZTogdGVhbVByb3BzLnNlcnZpY2VBY2NvdW50TmFtZSxcbiAgICAgICAgICAgIHNlcnZpY2VBY2NvdW50UG9saWNpZXM6IHRlYW1Qcm9wcy5zZXJ2aWNlQWNjb3VudFBvbGljaWVzLFxuICAgICAgICAgICAgdXNlclJvbGVBcm46IHRlYW1Qcm9wcy51c2VyUm9sZUFybixcbiAgICAgICAgICAgIHRlYW1TZWNyZXRzOiB0ZWFtUHJvcHMudGVhbVNlY3JldHMsXG4gICAgICAgICAgICB0ZWFtTWFuaWZlc3REaXI6IHRlYW1Qcm9wcy50ZWFtTWFuaWZlc3REaXIsXG4gICAgICAgICAgICBleHRlbnNpb25GdW5jdGlvbjogdGVhbVByb3BzLmV4dGVuc2lvbkZ1bmN0aW9uXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIHNldHVwKGNsdXN0ZXJJbmZvOiBDbHVzdGVySW5mbyk6IHZvaWQge1xuICAgICAgICB0aGlzLmRlZmF1bHRTZXR1cEFjY2VzcyhjbHVzdGVySW5mbyk7XG4gICAgICAgIHRoaXMuc2V0dXBOYW1lc3BhY2UoY2x1c3RlckluZm8pO1xuICAgICAgICB0aGlzLnNldHVwU2VydmljZUFjY291bnQoY2x1c3RlckluZm8pO1xuICAgICAgICB0aGlzLnNldHVwU2VjcmV0cyhjbHVzdGVySW5mbyk7XG4gICAgICAgIGlmICh0aGlzLnRlYW1Qcm9wcy5leHRlbnNpb25GdW5jdGlvbikge1xuICAgICAgICAgICAgdGhpcy50ZWFtUHJvcHMuZXh0ZW5zaW9uRnVuY3Rpb24odGhpcywgY2x1c3RlckluZm8pO1xuICAgICAgICAgfVxuICAgIH1cblxuICAgIHByb3RlY3RlZCBkZWZhdWx0U2V0dXBBY2Nlc3MoY2x1c3RlckluZm86IENsdXN0ZXJJbmZvKSB7XG4gICAgICAgIGNvbnN0IHByb3BzID0gdGhpcy50ZWFtUHJvcHM7ICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIGlmKCEoY2x1c3RlckluZm8uY2x1c3RlciBpbnN0YW5jZW9mIENsdXN0ZXIgfHwgY2x1c3RlckluZm8uY2x1c3RlcnYyIGluc3RhbmNlb2YgZWtzdjIuQ2x1c3RlcikpIHtcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKGBUZWFtICR7cHJvcHMubmFtZX0gaGFzIGNsdXN0ZXIgYWNjZXNzIHVwZGF0ZXMgdGhhdCBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIGltcG9ydGVkIGNsdXN0ZXJzYCApO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHVzZXJzID0gdGhpcy50ZWFtUHJvcHMudXNlcnMgPz8gW107XG4gICAgICAgIGNvbnN0IHRlYW1Sb2xlID0gdGhpcy5nZXRPckNyZWF0ZVJvbGUoY2x1c3RlckluZm8sIHVzZXJzLCBwcm9wcy51c2VyUm9sZUFybik7XG5cbiAgICAgICAgaWYoY2x1c3RlckluZm8uY2x1c3RlcnYyIGluc3RhbmNlb2YgZWtzdjIuQ2x1c3Rlcil7XG4gICAgICAgICAgICBjb25zdCBla3NDbHVzdGVydjI6IGVrc3YyLkNsdXN0ZXIgPSBjbHVzdGVySW5mby5jbHVzdGVydjIgYXMgZWtzdjIuQ2x1c3RlcjtcbiAgICAgICAgICAgIGlmKHRlYW1Sb2xlKXtcbiAgICAgICAgICAgICAgICBla3NDbHVzdGVydjIuZ3JhbnRBY2Nlc3MocHJvcHMubmFtZSsnLWFjY2VzcycsIHRlYW1Sb2xlLnJvbGVBcm4sIFtuZXcgZWtzdjIuQWNjZXNzUG9saWN5KHtcbiAgICAgICAgICAgICAgICAgICAgYWNjZXNzU2NvcGU6IHt0eXBlOiBla3N2Mi5BY2Nlc3NTY29wZVR5cGUuTkFNRVNQQUNFLCBuYW1lc3BhY2VzOiBbcHJvcHMubmFtZXNwYWNlIV19LCBcbiAgICAgICAgICAgICAgICAgICAgcG9saWN5OiBla3N2Mi5BY2Nlc3NQb2xpY3lBcm4uQU1BWk9OX0VLU19BRE1JTl9QT0xJQ1lcbiAgICAgICAgICAgICAgICB9KV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9ZWxzZSBpZihjbHVzdGVySW5mby5jbHVzdGVyIGluc3RhbmNlb2YgQ2x1c3Rlcil7XG4gICAgICAgICAgICBjb25zdCBla3NDbHVzdGVyIDogQ2x1c3RlciA9IGNsdXN0ZXJJbmZvLmNsdXN0ZXI7XG4gICAgICAgICAgICBjb25zdCBhd3NBdXRoID0gZWtzQ2x1c3Rlci5hd3NBdXRoO1xuICAgICAgICAgIGlmICh0ZWFtUm9sZSkge1xuICAgICAgICAgICAgYXdzQXV0aC5hZGRSb2xlTWFwcGluZyh0ZWFtUm9sZSwgeyBncm91cHM6IFtwcm9wcy5uYW1lc3BhY2UhICsgXCItdGVhbS1ncm91cFwiXSwgdXNlcm5hbWU6IHByb3BzLm5hbWUgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIG5ldyBDZm5PdXRwdXQoY2x1c3RlckluZm8uY2x1c3Rlci5zdGFjaywgcHJvcHMubmFtZSArICcgdGVhbSByb2xlICcsIHsgdmFsdWU6IHRlYW1Sb2xlID8gdGVhbVJvbGUucm9sZUFybiA6IFwibm9uZVwiIH0pO1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIGNsdXN0ZXJJbmZvIFxuICAgICAqL1xuICAgIHByb3RlY3RlZCBkZWZhdWx0U2V0dXBBZG1pbkFjY2VzcyhjbHVzdGVySW5mbzogQ2x1c3RlckluZm8pIHtcbiAgICAgICAgY29uc3QgcHJvcHMgPSB0aGlzLnRlYW1Qcm9wczsgICAgICAgIFxuICAgICAgICBcbiAgICAgICAgaWYoIShjbHVzdGVySW5mby5jbHVzdGVyIGluc3RhbmNlb2YgQ2x1c3RlciB8fCBjbHVzdGVySW5mby5jbHVzdGVydjIgaW5zdGFuY2VvZiBla3N2Mi5DbHVzdGVyKSkge1xuICAgICAgICAgICAgbG9nZ2VyLndhcm4oYFRlYW0gJHtwcm9wcy5uYW1lfSBoYXMgY2x1c3RlciBhY2Nlc3MgdXBkYXRlcyB0aGF0IGFyZSBub3Qgc3VwcG9ydGVkIHdpdGggaW1wb3J0ZWQgY2x1c3RlcnNgICk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWRtaW5zID0gdGhpcy50ZWFtUHJvcHMudXNlcnMgPz8gW107XG4gICAgICAgIGNvbnN0IGFkbWluUm9sZSA9IHRoaXMuZ2V0T3JDcmVhdGVSb2xlKGNsdXN0ZXJJbmZvLCBhZG1pbnMsIHByb3BzLnVzZXJSb2xlQXJuKTtcblxuICAgICAgICBpZihjbHVzdGVySW5mby5jbHVzdGVydjIgaW5zdGFuY2VvZiBla3N2Mi5DbHVzdGVyKXtcbiAgICAgICAgICAgIGNvbnN0IGVrc0NsdXN0ZXJ2MjogZWtzdjIuQ2x1c3RlciA9IGNsdXN0ZXJJbmZvLmNsdXN0ZXJ2MiE7XG4gICAgICAgICAgICBpZihhZG1pblJvbGUpe1xuICAgICAgICAgICAgICAgIGVrc0NsdXN0ZXJ2Mi5ncmFudEFjY2Vzcyhwcm9wcy5uYW1lKyctYWNjZXNzJywgYWRtaW5Sb2xlLnJvbGVBcm4sIFtuZXcgZWtzdjIuQWNjZXNzUG9saWN5KHtcbiAgICAgICAgICAgICAgICAgICAgYWNjZXNzU2NvcGU6IHt0eXBlOiBla3N2Mi5BY2Nlc3NTY29wZVR5cGUuQ0xVU1RFUn0sIFxuICAgICAgICAgICAgICAgICAgICBwb2xpY3k6IGVrc3YyLkFjY2Vzc1BvbGljeUFybi5BTUFaT05fRUtTX0NMVVNURVJfQURNSU5fUE9MSUNZXG4gICAgICAgICAgICAgICAgfSldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfWVsc2UgaWYgKGNsdXN0ZXJJbmZvLmNsdXN0ZXIgaW5zdGFuY2VvZiBDbHVzdGVyKXtcblxuXG4gICAgICAgICAgICBpZiAoYWRtaW5Sb2xlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZWtzQ2x1c3RlcjogQ2x1c3RlciA9IGNsdXN0ZXJJbmZvLmNsdXN0ZXI7XG4gICAgICAgICAgICAgICAgZWtzQ2x1c3Rlci5hd3NBdXRoLmFkZE1hc3RlcnNSb2xlKGFkbWluUm9sZSwgdGhpcy50ZWFtUHJvcHMubmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbmV3IENmbk91dHB1dChjbHVzdGVySW5mby5jbHVzdGVyLnN0YWNrLCBwcm9wcy5uYW1lICsgJyB0ZWFtIGFkbWluICcsIHsgdmFsdWU6IGFkbWluUm9sZSA/IGFkbWluUm9sZS5yb2xlQXJuIDogXCJub25lXCIgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyByb2xlIHdpdGggdHJ1c3QgcmVsYXRpb25zaGlwIG9yIGFkZHMgdHJ1c3QgcmVsYXRpb25zaGlwIGZvciBhbiBleGlzdGluZyByb2xlLlxuICAgICAqIEBwYXJhbSBjbHVzdGVySW5mbyBcbiAgICAgKiBAcGFyYW0gdXNlcnMgXG4gICAgICogQHBhcmFtIHJvbGUgbWF5IGJlIG51bGwgaWYgYm90aCByb2xlIGFuZCB1c2VycyB3ZXJlIG5vdCBwcm92aWRlZFxuICAgICAqIEByZXR1cm5zIFxuICAgICAqL1xuICAgIHByb3RlY3RlZCBnZXRPckNyZWF0ZVJvbGUoY2x1c3RlckluZm86IENsdXN0ZXJJbmZvLCB1c2VyczogQXJyYXk8aWFtLkFyblByaW5jaXBhbD4sIHJvbGVBcm4/OiBzdHJpbmcpOiBpYW0uSVJvbGUgfCB1bmRlZmluZWQge1xuICAgICAgICBsZXQgcm9sZTogSVJvbGUgfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIFxuICAgICAgICBpZiAocm9sZUFybikge1xuICAgICAgICAgICAgcm9sZSA9IGlhbS5Sb2xlLmZyb21Sb2xlQXJuKGNsdXN0ZXJJbmZvLmNsdXN0ZXIuc3RhY2ssIGAke3RoaXMubmFtZX0tdGVhbS1yb2xlYCwgcm9sZUFybik7XG4gICAgICAgICAgICB1c2Vycy5mb3JFYWNoKHVzZXIgPT4gcm9sZT8uZ3JhbnQodXNlciwgXCJzdHM6YXNzdW1lUm9sZVwiKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZih1c2VycyAmJiB1c2Vycy5sZW5ndGggPiAwKXtcbiAgICAgICAgICAgIHJvbGUgPSBuZXcgaWFtLlJvbGUoY2x1c3RlckluZm8uY2x1c3Rlci5zdGFjaywgdGhpcy50ZWFtUHJvcHMubmFtZXNwYWNlICsgJ0FjY2Vzc1JvbGUnLCB7XG4gICAgICAgICAgICAgICAgYXNzdW1lZEJ5OiBuZXcgaWFtLkNvbXBvc2l0ZVByaW5jaXBhbCguLi51c2VycylcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcm9sZS5hZGRUb1ByaW5jaXBhbFBvbGljeShuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgICAgICAgZWZmZWN0OiBpYW0uRWZmZWN0LkFMTE9XLFxuICAgICAgICAgICAgICAgIHJlc291cmNlczogW2NsdXN0ZXJJbmZvLmNsdXN0ZXIuY2x1c3RlckFybl0sXG4gICAgICAgICAgICAgICAgYWN0aW9uczogW1xuICAgICAgICAgICAgICAgICAgICBcImVrczpEZXNjcmliZU5vZGVncm91cFwiLFxuICAgICAgICAgICAgICAgICAgICBcImVrczpMaXN0Tm9kZWdyb3Vwc1wiLFxuICAgICAgICAgICAgICAgICAgICBcImVrczpEZXNjcmliZUNsdXN0ZXJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJla3M6TGlzdENsdXN0ZXJzXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiZWtzOkFjY2Vzc0t1YmVybmV0ZXNBcGlcIixcbiAgICAgICAgICAgICAgICAgICAgXCJzc206R2V0UGFyYW1ldGVyXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiZWtzOkxpc3RVcGRhdGVzXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiZWtzOkxpc3RGYXJnYXRlUHJvZmlsZXNcIlxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJvbGUuYWRkVG9QcmluY2lwYWxQb2xpY3kobmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgICAgICAgIGVmZmVjdDogaWFtLkVmZmVjdC5BTExPVyxcbiAgICAgICAgICAgICAgICByZXNvdXJjZXM6IFtcIipcIl0sXG4gICAgICAgICAgICAgICAgYWN0aW9uczogW1xuICAgICAgICAgICAgICAgICAgICBcImVrczpMaXN0Q2x1c3RlcnNcIlxuICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcm9sZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIG5hbWVzcGFjZSBhbmQgc2V0cyB1cCBwb2xpY2llcy5cbiAgICAgKiBAcGFyYW0gY2x1c3RlckluZm8gXG4gICAgICovXG4gICAgcHJvdGVjdGVkIHNldHVwTmFtZXNwYWNlKGNsdXN0ZXJJbmZvOiBDbHVzdGVySW5mbykge1xuICAgICAgICBjb25zdCBwcm9wcyA9IHRoaXMudGVhbVByb3BzO1xuICAgICAgICBjb25zdCBuYW1lc3BhY2VOYW1lID0gcHJvcHMubmFtZXNwYWNlITtcbiAgICAgICAgY29uc3QgdGVhbU1hbmlmZXN0RGlyID0gcHJvcHMudGVhbU1hbmlmZXN0RGlyO1xuXG4gICAgICAgIHRoaXMubmFtZXNwYWNlTWFuaWZlc3QgPSBuZXcgS3ViZXJuZXRlc01hbmlmZXN0KGNsdXN0ZXJJbmZvLmNsdXN0ZXIuc3RhY2ssIHByb3BzLm5hbWUsIHtcbiAgICAgICAgICAgIGNsdXN0ZXI6IGNsdXN0ZXJJbmZvLmNsdXN0ZXIsXG4gICAgICAgICAgICBtYW5pZmVzdDogW3tcbiAgICAgICAgICAgICAgICBhcGlWZXJzaW9uOiAndjEnLFxuICAgICAgICAgICAgICAgIGtpbmQ6ICdOYW1lc3BhY2UnLFxuICAgICAgICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IG5hbWVzcGFjZU5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGFubm90YXRpb25zOiBwcm9wcy5uYW1lc3BhY2VBbm5vdGF0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWxzOiBwcm9wcy5uYW1lc3BhY2VMYWJlbHNcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XSxcbiAgICAgICAgICAgIG92ZXJ3cml0ZTogdHJ1ZSxcbiAgICAgICAgICAgIHBydW5lOiB0cnVlXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChwcm9wcy5uYW1lc3BhY2VIYXJkTGltaXRzKSB7XG4gICAgICAgICAgICB0aGlzLnNldHVwTmFtZXNwYWNlUG9saWNpZXMoY2x1c3RlckluZm8sIG5hbWVzcGFjZU5hbWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZGVmYXVsdFJvbGVzID0gbmV3IERlZmF1bHRUZWFtUm9sZXMoKS5jcmVhdGVNYW5pZmVzdChuYW1lc3BhY2VOYW1lKTsgLy9UT0RPOiBhZGQgc3VwcG9ydCBmb3IgY3VzdG9tIFJCQUNcblxuICAgICAgICBjb25zdCByYmFjTWFuaWZlc3QgPSBuZXcgS3ViZXJuZXRlc01hbmlmZXN0KGNsdXN0ZXJJbmZvLmNsdXN0ZXIuc3RhY2ssIG5hbWVzcGFjZU5hbWUgKyBcIi1yYmFjXCIsIHtcbiAgICAgICAgICAgIGNsdXN0ZXI6IGNsdXN0ZXJJbmZvLmNsdXN0ZXIsXG4gICAgICAgICAgICBtYW5pZmVzdDogZGVmYXVsdFJvbGVzLFxuICAgICAgICAgICAgb3ZlcndyaXRlOiB0cnVlLFxuICAgICAgICAgICAgcHJ1bmU6IHRydWVcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmJhY01hbmlmZXN0Lm5vZGUuYWRkRGVwZW5kZW5jeSh0aGlzLm5hbWVzcGFjZU1hbmlmZXN0KTtcblxuICAgICAgICBpZiAodGVhbU1hbmlmZXN0RGlyKXtcbiAgICAgICAgICAgIGFwcGx5WWFtbEZyb21EaXIodGVhbU1hbmlmZXN0RGlyLCBjbHVzdGVySW5mby5jbHVzdGVyLCB0aGlzLm5hbWVzcGFjZU1hbmlmZXN0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdXAgcXVvdGFzXG4gICAgICogQHBhcmFtIGNsdXN0ZXJJbmZvIFxuICAgICAqIEBwYXJhbSBuYW1lc3BhY2VOYW1lIFxuICAgICAqL1xuICAgIHByb3RlY3RlZCBzZXR1cE5hbWVzcGFjZVBvbGljaWVzKGNsdXN0ZXJJbmZvOiBDbHVzdGVySW5mbywgbmFtZXNwYWNlTmFtZTogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IHF1b3RhTmFtZSA9IHRoaXMudGVhbVByb3BzLm5hbWUgKyBcIi1xdW90YVwiO1xuICAgICAgICBjb25zdCBxdW90YU1hbmlmZXN0ID0gY2x1c3RlckluZm8uY2x1c3Rlci5hZGRNYW5pZmVzdChxdW90YU5hbWUsIHtcbiAgICAgICAgICAgIGFwaVZlcnNpb246ICd2MScsXG4gICAgICAgICAgICBraW5kOiAnUmVzb3VyY2VRdW90YScsXG4gICAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgICAgIG5hbWU6IHF1b3RhTmFtZSxcbiAgICAgICAgICAgICAgICBuYW1lc3BhY2U6IG5hbWVzcGFjZU5hbWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzcGVjOiB7XG4gICAgICAgICAgICAgICAgaGFyZDogdGhpcy50ZWFtUHJvcHMubmFtZXNwYWNlSGFyZExpbWl0c1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcXVvdGFNYW5pZmVzdC5ub2RlLmFkZERlcGVuZGVuY3kodGhpcy5uYW1lc3BhY2VNYW5pZmVzdCk7XG4gICAgfVxuICAgIFxuICAgIC8qKlxuICAgICAqIFNldHMgdXAgU2VydmljZUFjY291bnQgZm9yIHRoZSB0ZWFtIG5hbWVzcGFjZVxuICAgICAqIEBwYXJhbSBjbHVzdGVySW5mbyBcbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgc2V0dXBTZXJ2aWNlQWNjb3VudChjbHVzdGVySW5mbzogQ2x1c3RlckluZm8pIHtcbiAgICAgICAgY29uc3Qgc2VydmljZUFjY291bnROYW1lID0gdGhpcy50ZWFtUHJvcHMuc2VydmljZUFjY291bnROYW1lPyB0aGlzLnRlYW1Qcm9wcy5zZXJ2aWNlQWNjb3VudE5hbWUgOiBgJHt0aGlzLnRlYW1Qcm9wcy5uYW1lfS1zYWA7XG4gICAgICAgIGNvbnN0IGNsdXN0ZXIgPSBjbHVzdGVySW5mby5jbHVzdGVyO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5zZXJ2aWNlQWNjb3VudCA9IGNsdXN0ZXIuYWRkU2VydmljZUFjY291bnQoYCR7dGhpcy50ZWFtUHJvcHMubmFtZX0tc2VydmljZS1hY2NvdW50YCwge1xuICAgICAgICAgICAgbmFtZTogc2VydmljZUFjY291bnROYW1lLFxuICAgICAgICAgICAgbmFtZXNwYWNlOiB0aGlzLnRlYW1Qcm9wcy5uYW1lc3BhY2VcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2VydmljZUFjY291bnQubm9kZS5hZGREZXBlbmRlbmN5KHRoaXMubmFtZXNwYWNlTWFuaWZlc3QpO1xuXG4gICAgICAgIGlmKHRoaXMudGVhbVByb3BzLnNlcnZpY2VBY2NvdW50UG9saWNpZXMpIHtcbiAgICAgICAgICAgIHRoaXMudGVhbVByb3BzLnNlcnZpY2VBY2NvdW50UG9saWNpZXMuZm9yRWFjaChwb2xpY3kgPT4gdGhpcy5zZXJ2aWNlQWNjb3VudC5yb2xlLmFkZE1hbmFnZWRQb2xpY3kocG9saWN5KSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzZXJ2aWNlQWNjb3VudE91dHB1dCA9IG5ldyBDZm5PdXRwdXQoY2x1c3RlckluZm8uY2x1c3Rlci5zdGFjaywgYCR7dGhpcy50ZWFtUHJvcHMubmFtZX0tc2FgLCB7XG4gICAgICAgICAgICB2YWx1ZTogc2VydmljZUFjY291bnROYW1lXG4gICAgICAgIH0pO1xuICAgICAgICBzZXJ2aWNlQWNjb3VudE91dHB1dC5ub2RlLmFkZERlcGVuZGVuY3kodGhpcy5uYW1lc3BhY2VNYW5pZmVzdCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB1cCBzZWNyZXRzXG4gICAgICogQHBhcmFtIGNsdXN0ZXJJbmZvXG4gICAgICovXG4gICAgcHJvdGVjdGVkIHNldHVwU2VjcmV0cyhjbHVzdGVySW5mbzogQ2x1c3RlckluZm8pIHtcbiAgICAgICAgaWYgKHRoaXMudGVhbVByb3BzLnRlYW1TZWNyZXRzKSB7XG4gICAgICAgICAgICBjb25zdCBzZWNyZXRQcm92aWRlckNsYXNzTmFtZSA9IHRoaXMudGVhbVByb3BzLm5hbWUgKyAnLWF3cy1zZWNyZXRzJztcbiAgICAgICAgICAgIG5ldyBTZWNyZXRQcm92aWRlckNsYXNzKGNsdXN0ZXJJbmZvLCB0aGlzLnNlcnZpY2VBY2NvdW50LCBzZWNyZXRQcm92aWRlckNsYXNzTmFtZSwgLi4udGhpcy50ZWFtUHJvcHMudGVhbVNlY3JldHMpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqIFBsYXRmb3JtIHRlYW0gd2lsbCBzZXR1cCBhbGwgdGVhbSBtZW1iZXJzIGFzIGFkbWluIGFjY2VzcyB0byB0aGUgY2x1c3RlciBieSBhZGRpbmcgdGhlbSB0byB0aGUgbWFzdGVyIGdyb3VwLlxuICogVGhlIHNldHVwIHNraXBzIG5hbWVzcGFjZS9xdW90YSBjb25maWd1cmF0aW9uLlxuICovXG5leHBvcnQgY2xhc3MgUGxhdGZvcm1UZWFtIGV4dGVuZHMgQXBwbGljYXRpb25UZWFtIHtcblxuICAgIGNvbnN0cnVjdG9yKHRlYW1Qcm9wczogVGVhbVByb3BzKSB7XG4gICAgICAgIHN1cGVyKHRlYW1Qcm9wcyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT3ZlcnJpZGVcbiAgICAgKiBAcGFyYW0gY2x1c3RlckluZm9cbiAgICAgKi9cbiAgICBzZXR1cChjbHVzdGVySW5mbzogQ2x1c3RlckluZm8pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5kZWZhdWx0U2V0dXBBZG1pbkFjY2VzcyhjbHVzdGVySW5mbyk7XG4gICAgfVxufVxuIl19